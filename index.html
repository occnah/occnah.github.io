<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Ossian Stange</title>

  <link rel="stylesheet" href="styles.css">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>

  <!-- Fullscreen HERO with Vanta background -->
  <header id="hero" class="hero">
    <div id="vanta-bg" class="vanta"></div>

    <div class="hero__content" role="banner" aria-label="Intro">
      <h1 class="hero__title">Hi, I’m Ossian</h1>
      <p class="hero__subtitle">Software Engineer & DevOps Specialist</p>
    </div>

    <button class="scroll-cue" id="scrollCue" aria-label="Scroll to content">
      <span>Scroll</span>
      <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M12 16l-6-6h12l-6 6z"></path>
      </svg>
    </button>
  </header>

  <!-- ROLES SCROLL SECTION -->
  <section id="roles" class="roles">
    <div class="roles__inner">
      <div class="roles__left">
        <h2 class="roles__fixed">I’m a</h2>
      </div>

      <div class="roles__right">
        <!-- All phrases are stacked; we animate opacity/position on scroll -->
        <div class="role"><span class="role__text">AI Engineer</span></div>
        <div class="role"><span class="role__text">DevOps Specialist</span></div>
        <div class="role"><span class="role__text">Fullstack Dev</span></div>
      </div>
    </div>
  </section>

  <!-- STICKY CASE STUDY: GRADR (FIRST, IMAGE RIGHT) -->
  <section id="case-gradr" class="case">
    <div class="case__inner">
      <!-- Left: scrolling copy -->
      <div class="case__left">
        <div class="case__panel">
          <p class="case__text">As a software engineer at <span class="grad-accent">Gradr</span>...</p>
        </div>

        <div class="case__panel">
          <p class="case__text">
            I help to create <span class="grad-number">AI solutions</span> for schools—automating grading tasks and letting students practice custom, teacher-tuned questions at scale.
          </p>
        </div>

        <div class="case__panel">
          <p class="case__text">
            Saving teachers <span class="grad-number">7+ hours</span> every week*
          </p>
          <small class="case__note">* Based on Gradr’s internal stats.</small>
        </div>

        <div class="case__panel">
          <p class="case__text">Helping <span class="grad-number">thousands</span> of students reach their full potential.</p>
        </div>
      </div>

      <!-- Right: sticky image (clickable) -->
      <div class="case__right">
        <figure class="case__shot">
          <a href="https://gradr.se" target="_blank" rel="noopener" aria-label="Open gradr.se">
            <img src="assets/gradr.png" alt="Gradr platform UI" loading="lazy" />
          </a>
          <figcaption class="visually-hidden">Pinned Gradr mockup while copy scrolls.</figcaption>
        </figure>
      </div>
    </div>
  </section>

  <!-- STICKY CASE STUDY: THS BUSINESS (SECOND, IMAGE LEFT) -->
  <section id="case-ths" class="case case--flip">
    <div class="case__inner">
      <!-- Left: sticky image (clickable) -->
      <div class="case__right">
        <figure class="case__shot">
          <a href="https://thsbusiness.se" target="_blank" rel="noopener" aria-label="Open thsbusiness.se">
            <img src="assets/thsb.png" alt="THS Business website design by Ossian" loading="lazy" />
          </a>
          <figcaption class="visually-hidden">Pinned THS Business mockup while copy scrolls.</figcaption>
        </figure>
      </div>

      <!-- Right: scrolling copy -->
      <div class="case__left">
        <div class="case__panel">
          <p class="case__text">As DevOps Lead at <span class="grad-accent">THS Business</span>...</p>
        </div>

        <div class="case__panel">
          <p class="case__text">I designed and scaled <span class="grad-accent">AWS</span> infrastructure to handle job applications and event content reliably.</p>
        </div>

        <div class="case__panel">
          <p class="case__text">
            Helping <span class="grad-number">18,000+</span> students and <span class="grad-number">150+</span> companies every year.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- HACKER WALL -->
  <section id="hacker" class="hacker">
    <canvas id="hacker-canvas" aria-hidden="true"></canvas>
    <h2 class="hacker__title">Think that is it?</h2>
  </section>

  <!-- PLANET GENERATOR (fullscreen -> shrink to card -> spotlight text) -->
  <section id="planet" class="planet">
    <div class="planet__pin">
      <!-- Fullscreen image that will shrink into the card on the right -->
      <!-- Replace assets/planet.png with your real image path -->
      <div class="planet__bg" style="--planet-img: url('assets/indaproj.png');"></div>

      <!-- Final layout (text left, card right) -->
      <div class="planet__inner">
        <div class="planet__left">
          <ul class="planet__copy" aria-label="Planet generator details">
            <li class="planet__line">Think again.</li>
            <li class="planet__line">Planet generator.</li>
            <li class="planet__line">Handmade with math.</li>
          </ul>
        </div>
        <div class="planet__right">
          <!-- Invisible sizing target; the background image animates to this rect -->
          <div class="planet__card case__shot" aria-hidden="true"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- STICKY CASE STUDY: APPS (static text, images switch) -->
  <section id="case-apps" class="case case--flip">
    <div class="case__inner">
      <!-- Left: sticky image card with stacked images -->
      <div class="case__right">
        <figure class="case__shot case__shot--stack">
          <!-- Replace src paths with your real assets -->
          <img class="case__img" src="assets/gymtrack34.png" alt="App interface 1" loading="lazy" decoding="async" />
          <img class="case__img" src="assets/calcrn2.png" alt="App interface 2" loading="lazy" decoding="async" />
          <img class="case__img" src="assets/hakyo.png" alt="App interface 3" loading="lazy" decoding="async" />
          <figcaption class="visually-hidden">App gallery cycling through three UIs.</figcaption>
        </figure>
      </div>

      <!-- Right: static copy -->
      <div class="case__left">
        <div class="case__panel">
          <p class="case__text">I have also made apps.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- STICKY CASE STUDY: WEBSITES (static text left, images right) -->
  <section id="case-sites" class="case">
    <div class="case__inner">
      <!-- Left: static copy -->
      <div class="case__left">
        <div class="case__panel">
          <p class="case__text">Countless websites...</p>
        </div>
      </div>

      <!-- Right: sticky image card with stacked images -->
      <div class="case__right">
        <figure class="case__shot case__shot--stack">
          <!-- Replace these with your real assets -->
          <img class="case__img" src="assets/honcweb.png" alt="Website 1" loading="lazy" decoding="async" />
          <img class="case__img" src="assets/kanjiking.png" alt="Website 3" loading="lazy" decoding="async" />
          <img class="case__img" src="assets/pyaudio.png" alt="Website 2" loading="lazy" decoding="async" />
          <img class="case__img" src="assets/library.png" alt="Website 4" loading="lazy" decoding="async" />
          <img class="case__img" src="assets/twitproj.png" alt="Website 4" loading="lazy" decoding="async" />
          <img class="case__img" src="assets/osq.jpg" alt="Website 6" loading="lazy" decoding="async" />
          <img class="case__img" src="assets/koreakeys.png" alt="Website 5" loading="lazy" decoding="async" />
          <figcaption class="visually-hidden">Website gallery cycling through five UIs.</figcaption>
        </figure>
      </div>
    </div>
  </section>

  <!-- MORE: parallax cloud of project cards around a central headline -->
  <section id="more" class="more" aria-label="More projects">
    <div class="more__pin">
      <h2 class="more__title" aria-label="and so much more">And so much more</h2>

      <div class="more__cloud" aria-hidden="true">
        <!-- Replace thumbnails/labels as you like -->
        <article class="more__card" data-depth="-520"><img src="assets/honccafest.png" alt="" /><span>Arcade Games</span></article>
        <article class="more__card" data-depth="-420"><img src="assets/gmm.png" alt="" /><span>Guassian Mixture Models</span></article>
        <article class="more__card" data-depth="-360"><img src="assets/matlabweather.png" alt="" /><span>Weather Predictor</span></article>
        <article class="more__card" data-depth="-260"><img src="assets/rsa.png" alt="" /><span>RSA Algorithm</span></article>
        <article class="more__card" data-depth="-160"><img src="assets/svm.png" alt="" /><span>Support Vectors</span></article>
        <article class="more__card" data-depth="-80"><img src="assets/water.png" alt="" /><span>Water Shaders</span></article>
        <article class="more__card" data-depth="0"><img src="assets/1d.png" alt="" /><span>Bayesian Inference</span></article>
        <article class="more__card" data-depth="80"><img src="assets/fivemproj.jpg" alt="" /><span>FiveM Mods</span></article>
        <article class="more__card" data-depth="160"><img src="assets/ray.png" alt="" /><span>Analytics</span></article>
        <article class="more__card" data-depth="240"><img src="assets/procedural.png" alt="" /><span>Perlin Noise</span></article>
      </div>
    </div>
  </section>

  <!-- CONTACT (fullscreen) -->
  <section id="contact" class="contact contact--hero" role="contentinfo">
    <div class="contact__wrap">
      <p class="contact__eyebrow">Contact</p>

      <h2 class="contact__title">Let’s build something great.</h2>
      <p class="contact__sub">Think you are a genius? Come join us at gradr and prove it.</p>

      <div class="contact__actions">
        <a class="contact__btn contact__btn--primary" href="https://github.com/occnah" target="_blank" rel="noopener" aria-label="Ossian on GitHub">
          <!-- GitHub mark -->
          <svg aria-hidden="true" width="20" height="20" viewBox="0 0 24 24" role="img">
            <path fill="currentColor" d="M12 2a10 10 0 0 0-3.16 19.49c.5.09.68-.22.68-.48v-1.7c-2.78.6-3.37-1.19-3.37-1.19-.45-1.16-1.1-1.47-1.1-1.47-.9-.62.07-.6.07-.6 1 .07 1.53 1.02 1.53 1.02.89 1.53 2.34 1.09 2.9.83.09-.65.35-1.09.63-1.34-2.22-.25-4.56-1.11-4.56-4.95 0-1.09.39-1.98 1.02-2.68-.1-.25-.45-1.27.1-2.65 0 0 .84-.27 2.75 1.02A9.57 9.57 0 0 1 12 7.5c.85 0 1.7.12 2.5.35 1.9-1.29 2.74-1.02 2.74-1.02.56 1.38.21 2.4.11 2.65.63.7 1.02 1.59 1.02 2.68 0 3.85-2.34 4.7-4.57 4.95.36.31.68.92.68 1.86v2.75c0 .27.18.58.69.48A10 10 0 0 0 12 2z"/>
          </svg>
          <span>GitHub</span>
        </a>

        <a class="contact__btn" href="https://www.linkedin.com/in/your-handle" target="_blank" rel="noopener" aria-label="Ossian on LinkedIn">
          <svg aria-hidden="true" width="20" height="20" viewBox="0 0 24 24">
            <path d="M4.98 3.5C4.98 4.88 3.86 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1s2.48 1.12 2.48 2.5ZM0 8h5v16H0V8Zm7.5 0h4.8v2.2h.07c.67-1.2 2.3-2.46 4.73-2.46 5.06 0 6 3.33 6 7.65V24h-5v-7.3c0-1.74-.03-3.97-2.42-3.97-2.43 0-2.8 1.89-2.8 3.84V24h-5V8Z" fill="currentColor"/>
          </svg>
          <span>LinkedIn</span>
        </a>
      </div>

      <div class="contact__meta">
        <a href="mailto:ossianst@kth.se">ossianst@kth.se</a>
        <span aria-hidden="true">·</span>
        <span>Stockholm, Sweden</span>
      </div>
    </div>
  </section>

  <!-- Vanta on HERO -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.waves.min.js"></script>
  <script>
    // Ensure the element exists before initializing Vanta
    let vantaEffect;
    window.addEventListener('DOMContentLoaded', () => {
      VANTA.WAVES({
        el: "#vanta-bg",
        mouseControls: true,
        touchControls: true,
        gyroControls: false,
        minHeight: 200.00,
        minWidth: 200.00,
        scale: 1.00,
        scaleMobile: 1.00,
        color: 0x162a
      })

      // Smooth scroll to the first section
      const cue = document.getElementById('scrollCue');
      cue?.addEventListener('click', () => {
        document.querySelector('#roles')?.scrollIntoView({ behavior: 'smooth' });
      });
    });

    // Clean up (optional good practice if you later navigate SPA-style)
    window.addEventListener('beforeunload', () => {
      if (vantaEffect && vantaEffect.destroy) vantaEffect.destroy();
    });
  </script>

  <!-- GSAP + ScrollTrigger (for scroll-driven transitions) -->
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>

  <!-- Contact entrance -->
  <script>
  </script>

  <!-- Roles timeline -->
  <script>
    // Scroll-driven role cycling
    window.addEventListener('DOMContentLoaded', () => {
      gsap.registerPlugin(ScrollTrigger);

      const phrases = gsap.utils.toArray('#roles .role');
      gsap.set(phrases.map(el => el.querySelector('.role__text')), { opacity: 0, y: 30 });

      const tl = gsap.timeline({
        scrollTrigger: {
          trigger: '#roles',
          start: 'top top',
          end: () => '+=' + (phrases.length * window.innerHeight * 0.85),
          scrub: 0.6,
          pin: true,
          anticipatePin: 1
        }
      });

      phrases.forEach((el) => {
        const t = el.querySelector('.role__text');
        tl.to(t, { opacity: 1, y: 0, duration: 0.8, ease: 'power2.out' });
        tl.to({}, { duration: 0.6 });
        tl.to(t, { opacity: 0, y: -30, duration: 0.8, ease: 'power2.in' });
      });

      // Accessibility: avoid tabbing to hidden items
      ScrollTrigger.addEventListener('refresh', () => {
        phrases.forEach(el => {
          const visible = parseFloat(gsap.getProperty(el.querySelector('.role__text'), 'opacity')) > 0.5;
          el.setAttribute('aria-hidden', visible ? 'false' : 'true');
        });
      });
    });
  </script>

  <!-- Case: GRADR -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      // === Sticky case: GRADR (image right, copy left) ===
      const gradrPanels = gsap.utils.toArray('#case-gradr .case__panel');
      const gradrTexts  = gradrPanels.map(p => p.querySelector('.case__text'));
      const gradrNotes  = gradrPanels.map(p => p.querySelector('.case__note')).filter(Boolean);

      gsap.set(gradrTexts, { opacity: 0, y: 30 });
      gsap.set(gradrNotes, { opacity: 0, y: 20 });

      const tlGradr = gsap.timeline({
        scrollTrigger: {
          trigger: '#case-gradr',
          start: 'top top',
          end: () => '+=' + (gradrPanels.length * window.innerHeight * 0.9),
          scrub: 0.6,
          pin: true,
          anticipatePin: 1
        }
      });

      gradrPanels.forEach((panel) => {
        const t = panel.querySelector('.case__text');
        const n = panel.querySelector('.case__note');

        tlGradr
          .to(t, { opacity: 1, y: 0, duration: 0.9, ease: 'power2.out' })
          .to(n || {}, { opacity: 1, y: 0, duration: n ? 0.6 : 0, ease: 'power2.out' }, '<+=0.2')
          .to({}, { duration: 0.8 }) // hold
          .to([t, n].filter(Boolean), { opacity: 0, y: -28, duration: 0.8, ease: 'power2.in' });
      });

      // subtle parallax for the mock
      gsap.to('#case-gradr .case__shot', {
        yPercent: -6,
        ease: 'none',
        scrollTrigger: {
          trigger: '#case-gradr',
          start: 'top top',
          end: 'bottom top',
          scrub: true
        }
      });
    });
  </script>

  <!-- Case: THS BUSINESS -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      // === Sticky case: THS (image left, copy right) ===
      const panels = gsap.utils.toArray('#case-ths .case__panel');
      const texts  = panels.map(p => p.querySelector('.case__text'));

      gsap.set(texts, { opacity: 0, y: 30 });

      const tlCase = gsap.timeline({
        scrollTrigger: {
          trigger: '#case-ths',
          start: 'top top',
          end: () => '+=' + (panels.length * window.innerHeight * 0.9),
          scrub: 0.6,
          pin: true,
          anticipatePin: 1
        }
      });

      panels.forEach((panel) => {
        const t = panel.querySelector('.case__text');
        tlCase.to(t, { opacity: 1, y: 0, duration: 0.9, ease: 'power2.out' });
        tlCase.to({}, { duration: 0.8 });
        tlCase.to(t, { opacity: 0, y: -28, duration: 0.8, ease: 'power2.in' });
      });

      gsap.to('#case-ths .case__shot', {
        yPercent: -6,
        ease: 'none',
        scrollTrigger: {
          trigger: '#case-ths',
          start: 'top top',
          end: 'bottom top',
          scrub: true
        }
      });
    });
  </script>

  <script>
/* HACKER WALL: render immediately, activate on partial view, pin at top */
(function () {
  function initHackerCanvas() {
    const section = document.getElementById('hacker');
    if (!section) return;

    const canvas = document.getElementById('hacker-canvas');
    const ctx = canvas.getContext('2d');
    const CHARS  = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789{}[]()<>=+-*/|\\_:#$%&@!?;.,~^';
    const COLORS = ['#60dca3', '#2b4439', '#5fb0d3'];

    let width, height, cols, rows, cell, fontSize, grid = [];
    let active = false;
    let last = 0;
    const interval = 28;
    const changeRatio = 0.22;

    function resize() {
      const dpr = window.devicePixelRatio || 1;
      width  = section.clientWidth;
      height = section.clientHeight;

      canvas.width  = Math.floor(width * dpr);
      canvas.height = Math.floor(height * dpr);
      canvas.style.width  = width + 'px';
      canvas.style.height = height + 'px';
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

      fontSize = Math.max(11, Math.min(18, Math.round(width / 85)));
      cell = fontSize * 1.1;

      ctx.font = `${fontSize}px ui-monospace, SFMono-Regular, Menlo, Consolas, Monaco, monospace`;
      ctx.textBaseline = 'top';

      cols = Math.ceil(width / cell);
      rows = Math.ceil(height / cell);

      grid = new Array(cols * rows).fill(0).map(() => ({
        ch: CHARS[(Math.random() * CHARS.length) | 0],
        color: COLORS[(Math.random() * COLORS.length) | 0]
      }));
    }

    function render() {
      // Always render at least once so there’s never a blank frame
      ctx.fillStyle = '#0b0f1a';
      ctx.fillRect(0, 0, width, height);
      let i = 0;
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const cellData = grid[i++];
          ctx.fillStyle = cellData.color;
          ctx.fillText(cellData.ch, c * cell, r * cell);
        }
      }
    }

    function tick(t) {
      requestAnimationFrame(tick);
      if (!active) return;
      if (t - last < interval) return;
      last = t;

      const changes = Math.max(1, Math.floor(grid.length * changeRatio));
      for (let k = 0; k < changes; k++) {
        const idx = (Math.random() * grid.length) | 0;
        grid[idx].ch    = CHARS[(Math.random() * CHARS.length) | 0];
        grid[idx].color = COLORS[(Math.random() * COLORS.length) | 0];
      }
      render();
    }

    resize();
    render();                // <-- immediate first paint (fixes “invisible until snap”)
    window.addEventListener('resize', () => { resize(); render(); });
    requestAnimationFrame(tick);

    // GSAP / ScrollTrigger wiring
    if (window.gsap && window.ScrollTrigger) {
      gsap.registerPlugin(ScrollTrigger);

      // Entrance title (unchanged)
      gsap.set('#hacker .hacker__title', { opacity: 0, y: 30 });
      gsap.to('#hacker .hacker__title', {
        opacity: 1, y: 0, duration: 0.9, ease: 'power2.out',
        scrollTrigger: { trigger: section, start: 'top 75%', once: true }
      });

      const HACKER_HOLD = 0.9;

      // 1) Activation trigger: as soon as section is partially visible
      ScrollTrigger.create({
        trigger: section,
        start: 'top bottom',     // section top hits bottom of viewport
        end:   'bottom top',     // section bottom leaves top of viewport
        onEnter:      () => { active = true;  render(); },
        onEnterBack:  () => { active = true;  render(); },
        onLeave:      () => { active = false; },
        onLeaveBack:  () => { active = false; }
      });

      // 2) Pinning trigger: only handles the pin (kept at top)
      ScrollTrigger.create({
        trigger: section,
        start: 'top top',
        end: () => '+=' + Math.round(window.innerHeight * HACKER_HOLD),
        pin: true,
        pinSpacing: true,
        anticipatePin: 1,
        // no onEnter/onLeave here — activation is handled above
      });

      // Recompute sizes/positions on refresh (e.g., font load, orientation change)
      ScrollTrigger.addEventListener('refreshInit', () => {
        resize();
        render();
      });

      // A nudge after heavy async stuff (fonts, images, Vanta) settles
      window.addEventListener('load', () => {
        ScrollTrigger.refresh();
      });
    } else {
      // Fallback: just run
      active = true;
    }
  }

  window.addEventListener('DOMContentLoaded', initHackerCanvas);
})();
</script>

  <script>
  // PLANET: full-bleed -> shrink-to-card -> spotlight exactly one line
  window.addEventListener('DOMContentLoaded', () => {
    if (!window.gsap || !window.ScrollTrigger) return;
    gsap.registerPlugin(ScrollTrigger);

    const section = document.querySelector('#planet');
    if (!section) return;

    const bg    = section.querySelector('.planet__bg');
    const card  = section.querySelector('.planet__card');
    const left  = section.querySelector('.planet__left');
    const lines = gsap.utils.toArray('.planet__line');

    // read the muted color from CSS (fallback just in case)
    const MUTED = getComputedStyle(section).getPropertyValue('--planet-muted')?.trim() || '#9aa0a6';

    function targetRect() {
      const s = section.getBoundingClientRect();
      const r = card.getBoundingClientRect();
      return {
        left:   r.left - s.left,
        top:    r.top  - s.top,
        width:  r.width,
        height: r.height
      };
    }

    const tlPlanet = gsap.timeline({
      scrollTrigger: {
        trigger: section,
        start: 'top top',
        end: () => '+=' + Math.round(window.innerHeight * 2.6),
        scrub: 0.7,
        pin: true,
        anticipatePin: 1,
        invalidateOnRefresh: true
      }
    });

    // A) Morph the full-bleed bg into the card
    tlPlanet.to(bg, {
      duration: 1.15,
      ease: 'power2.inOut',
      borderRadius: 18,
      boxShadow: '0 8px 24px rgba(0,0,0,0.25), 0 24px 64px rgba(0,0,0,0.35)',
      left:   () => targetRect().left,
      top:    () => targetRect().top,
      width:  () => targetRect().width,
      height: () => targetRect().height
    }, 0);

    // B) Reveal the text block
    tlPlanet.to(left, {
      duration: 0.5,
      opacity: 1,
      y: 0,
      ease: 'power2.out'
    });

    // C) Spotlight: exactly one white at a time (no overlap)
    //    Use instantaneous state switches so scrubbing never shows two.
    gsap.set(lines, { color: MUTED });

    const FADE = 0.15, HOLD = 0.45;
    gsap.set(lines, { color: MUTED });

    lines.forEach((line) => {
      tlPlanet
        .to(lines, { color: MUTED, duration: FADE, overwrite: 'auto' })   // ensure all muted first
        .to(line,  { color: '#ffffff', duration: FADE, overwrite: 'auto' }) // then light the one
        .to({}, { duration: HOLD });
    });

    // Reset geometry on refresh
    ScrollTrigger.addEventListener('refreshInit', () => {
      gsap.set(bg, { clearProps: 'left,top,width,height' });
    });
  });
  </script>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      if (!window.gsap || !window.ScrollTrigger) return;
      gsap.registerPlugin(ScrollTrigger);

      const section = document.querySelector('#case-apps');
      if (!section) return;

      const images = gsap.utils.toArray('#case-apps .case__shot--stack .case__img');
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      // Initial states
      gsap.set(images, { opacity: 0 });
      gsap.set(images[0], { opacity: 1 });

      // Pin + scrub timeline: fade 1->2->3 with a little hold on each
      if (!prefersReduced) {
        const hold   = 2;  // how long each image is "fully on"
        const fade   = 0.1;  // crossfade duration
        const totalH = images.length * (hold + fade); // used just for relative spacing

        const tlApps = gsap.timeline({
          scrollTrigger: {
            trigger: section,
            start: 'top top',
            end: () => '+=' + Math.round(window.innerHeight * 0.9), // same feel as your other cases
            scrub: 0.6,
            pin: true,
            anticipatePin: 1
          }
        });

        // Crossfades
        // img0 (already visible) -> img1
        if (images[1]) {
          tlApps
            .to({}, { duration: hold })
            .to(images[1], { opacity: 1, duration: fade, ease: 'power2.inOut' }, '<')
            .to(images[0], { opacity: 0, duration: fade, ease: 'power2.inOut' }, '<');
        }
        // img1 -> img2
        if (images[2]) {
          tlApps
            .to({}, { duration: hold })
            .to(images[2], { opacity: 1, duration: fade, ease: 'power2.inOut' }, '<')
            .to(images[1], { opacity: 0, duration: fade, ease: 'power2.inOut' }, '<');
        }

        // Subtle parallax on the card (matches other cases)
        gsap.to('#case-apps .case__shot', {
          yPercent: -6,
          ease: 'none',
          scrollTrigger: {
            trigger: section,
            start: 'top top',
            end: 'bottom top',
            scrub: true
          }
        });
      }
    });
  </script>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      if (!window.gsap || !window.ScrollTrigger) return;
      gsap.registerPlugin(ScrollTrigger);

      const section = document.querySelector('#case-sites');
      if (!section) return;

      const images = gsap.utils.toArray('#case-sites .case__shot--stack .case__img');
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      // Initial states
      gsap.set(images, { opacity: 0 });
      if (images[0]) gsap.set(images[0], { opacity: 1 });

      if (!prefersReduced && images.length > 1) {
        const hold = 0.45;      // short pause while each image is fully on
        const fade = 0.1;      // quick, snappy crossfade
        const ease = 'power1.inOut';

        // Scroll length scales with number of transitions
        const transitions = images.length - 1;
        const scrollLen = Math.round(window.innerHeight * (0.6 + transitions * 0.35));

        const tlSites = gsap.timeline({
          scrollTrigger: {
            trigger: section,
            start: 'top top',
            end: () => '+=' + scrollLen,
            scrub: 0.6,
            pin: true,
            anticipatePin: 1
          }
        });

        // Build crossfades 0->1->2->...->N
        for (let i = 1; i < images.length; i++) {
          tlSites
            .to({}, { duration: hold })
            .to(images[i],   { opacity: 1, duration: fade, ease }, '<')
            .to(images[i-1], { opacity: 0, duration: fade, ease }, '<');
        }

        // Subtle parallax (same vibe as other cases)
        gsap.to('#case-sites .case__shot', {
          yPercent: -6,
          ease: 'none',
          scrollTrigger: {
            trigger: section,
            start: 'top top',
            end: 'bottom top',
            scrub: true
          }
        });
      }
    });
  </script>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      if (!window.gsap || !window.ScrollTrigger) return;
      gsap.registerPlugin(ScrollTrigger);

      const section = document.querySelector('#more');
      if (!section) return;

      const pin   = section.querySelector('.more__pin');
      const title = section.querySelector('.more__title');
      const cards = gsap.utils.toArray('.more__card');

      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (prefersReduced) return;

      // Predefined positions across the viewport (xvw, yvh)
      // Tweak these to taste; they avoid clustering and feel balanced around the center
      const layout = [
        { x: 8,  y: 12 },  { x: 72, y: 18 },
        { x: 16, y: 58 },  { x: 84, y: 66 },
        { x: 50, y: 12 },  { x: 30, y: 76 },
        { x: 62, y: 80 },  { x: 12, y: 86 },
        { x: 86, y: 40 },  { x: 38, y: 24 },
      ];

      // Map depth (in px) to blur (in px). Farther = blurrier.
      const blurForDepth = (z) => {
        // z typically ranges from about -520 (far) to +240 (near)
        const t = gsap.utils.clamp(0,1,( -z + 100 ) / 700); // invert: far (negative) -> larger t
        return gsap.utils.interpolate(6, 0.6, 1 - t);       // 6px far, 0.6px near
      };

      // z-index by depth so near cards can go above the title (z-index 5)
      const zIndexForDepth = (z) => (z > 120 ? 6 : z > 0 ? 5 : 3);

      // Initial placement & depth styling
      cards.forEach((card, i) => {
        const pos = layout[i % layout.length];
        const z   = parseFloat(card.dataset.depth || 0); // from HTML
        const blur = blurForDepth(z);
        card.style.filter = `blur(${blur}px)`;
        card.style.zIndex = String(zIndexForDepth(z));

        // Place in 3D space: translateZ gives perspective parallax
        gsap.set(card, {
          x: pos.x + 'vw',
          y: pos.y + 'vh',
          z: z,
          rotateZ: gsap.utils.random(-2, 2), // tiny tilt variation
          transformPerspective: 900,
          transformStyle: 'preserve-3d'
        });
      });

      const scrollLen = () => Math.round(window.innerHeight * 2.2);

      // Pin the scene
      const tl = gsap.timeline({
        scrollTrigger: {
          trigger: section,
          start: 'top top',
          end: () => '+=' + scrollLen(),
          scrub: 0.8,
          pin: true,
          anticipatePin: 1,
          invalidateOnRefresh: true
        }
      });

      // Headline: appear + subtle scale up
      tl.fromTo(title,
        { opacity: 0, y: 28, scale: 0.96 },
        { opacity: 1, y: 0, scale: 1, duration: 0.9, ease: 'power2.out' },
        0
      );

      // Optional glow pulse as you progress
      tl.to(title, {
        textShadow: '0 0 0 rgba(255,255,255,0), 0 10px 40px rgba(0,0,0,.35)',
        duration: 0.3,
        ease: 'power1.out'
      }, '>-0.2');

      // Parallax for each card: deeper cards move more slowly; near cards drift more
      cards.forEach((card, i) => {
        const z = parseFloat(card.dataset.depth || 0);

        // Speed factor: far (negative) -> slow; near (positive) -> faster
        const speed = gsap.utils.mapRange(-520, 240, 0.2, 1.1, z);

        // Slight in/out Z drift to enhance depth without changing blur (CSS filter stays)
        const zDrift = gsap.utils.mapRange(-520, 240, 40, -20, z);

        // Build a tiny sub-timeline per card locked to main tl's progress
        tl.to(card, {
          y: `+=${gsap.utils.interpolate(-120, 140, (i % 10)/9) * speed}`, // varied directions
          x: `+=${gsap.utils.interpolate(60, -60, (i % 10)/9) * (speed * 0.6)}`,
          rotation: `+=${gsap.utils.random(-1.2, 1.2)}`,
          z: `+=${zDrift}`,
          duration: 1, ease: 'none'
        }, 0);
      });

      // Keep geometry fresh on resize/refresh
      ScrollTrigger.addEventListener('refreshInit', () => {
        // Re-apply positions so layout doesn't drift after font/image loads
        cards.forEach((card, i) => {
          const pos = layout[i % layout.length];
          gsap.set(card, { x: pos.x + 'vw', y: pos.y + 'vh' });
        });
      });
    });
  </script>

</body>
</html>
